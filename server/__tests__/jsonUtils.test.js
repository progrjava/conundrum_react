// –§–∞–π–ª: server/__tests__/jsonUtils.test.js

// –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä—É—é –±—É–¥–µ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
const { cleanApiResponse } = require('../utils/jsonUtils');

// describe - —ç—Ç–æ –≥—Ä—É–ø–ø–∞ —Ç–µ—Å—Ç–æ–≤, –ø–æ—Å–≤—è—â–µ–Ω–Ω–∞—è –æ–¥–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏.
// –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ - —Ñ—É–Ω–∫—Ü–∏–∏ cleanApiResponse.
describe('jsonUtils.cleanApiResponse', () => {

    // –í–ª–æ–∂–µ–Ω–Ω—ã–π describe –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –±–∞–∑–æ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
    describe('–ë–∞–∑–æ–≤—ã–µ –∏ –∫—Ä–∞–µ–≤—ã–µ —Å–ª—É—á–∞–∏', () => {
        
        test('–¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –¥–ª—è null –∏–ª–∏ undefined –≤—Ö–æ–¥–∞', () => {
            expect(cleanApiResponse(null)).toBe('[]');
            expect(cleanApiResponse(undefined)).toBe('[]');
        });

        test('–¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –¥–ª—è –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–∏', () => {
            expect(cleanApiResponse('')).toBe('[]');
        });

        test('–¥–æ–ª–∂–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —É–∂–µ –≤–∞–ª–∏–¥–Ω—ã–π JSON –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π', () => {
            const validJson = '[{"word":"—Ç–µ—Å—Ç","clue":"–ø—Ä–æ–≤–µ—Ä–∫–∞"}]';
            // –û–∂–∏–¥–∞–µ–º, —á—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç –∏–¥–µ–Ω—Ç–∏—á–µ–Ω –≤—Ö–æ–¥—É
            expect(cleanApiResponse(validJson)).toBe(validJson);
        });

        test('–¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤, –µ—Å–ª–∏ –Ω–∞ –≤—Ö–æ–¥–µ —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–π –º—É—Å–æ—Ä –±–µ–∑ JSON', () => {
            const dirty = '–ü—Ä–æ—Å—Ç–æ —Ç–µ–∫—Å—Ç –±–µ–∑ –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã—Ö —Å–∫–æ–±–æ–∫.';
            expect(cleanApiResponse(dirty)).toBe('[]');
        });
    });

    // –ì—Ä—É–ø–ø–∞ —Ç–µ—Å—Ç–æ–≤, –ø—Ä–æ–≤–µ—Ä—è—é—â–∞—è –æ—á–∏—Å—Ç–∫—É –æ—Ç "–º—É—Å–æ—Ä–∞"
    describe('–û—á–∏—Å—Ç–∫–∞ –æ—Ç –ø–æ—Å—Ç–æ—Ä–æ–Ω–Ω–µ–≥–æ "–º—É—Å–æ—Ä–∞"', () => {

        test('–¥–æ–ª–∂–µ–Ω —É–¥–∞–ª—è—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ã–π –º—É—Å–æ—Ä –¥–æ –∏ –ø–æ—Å–ª–µ JSON', () => {
            const dirty = '–í–æ—Ç –≤–∞—à JSON: [{"word":"—Ç–µ—Å—Ç"}] –°–ø–∞—Å–∏–±–æ –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ.';
            const expected = '[{"word":"—Ç–µ—Å—Ç"}]';
            expect(cleanApiResponse(dirty)).toBe(expected);
        });

        test('–¥–æ–ª–∂–µ–Ω —É–¥–∞–ª—è—Ç—å Markdown –±–ª–æ–∫–∏ ```json –∏ ```', () => {
            const dirty = '```json\n[{"word":"—Ç–µ—Å—Ç"}]\n```';
            const expected = '[{"word":"—Ç–µ—Å—Ç"}]';
            expect(cleanApiResponse(dirty)).toBe(expected);
        });

        test('–¥–æ–ª–∂–µ–Ω —É–¥–∞–ª—è—Ç—å –≤–Ω–µ—à–Ω–∏–µ –æ–¥–∏–Ω–∞—Ä–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏', () => {
            const dirty = `'[{"word":"—Ç–µ—Å—Ç"}]'`;
            const expected = '[{"word":"—Ç–µ—Å—Ç"}]';
            expect(cleanApiResponse(dirty)).toBe(expected);
        });

        test('–¥–æ–ª–∂–µ–Ω –∑–∞–º–µ–Ω—è—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã, —Ç–∞–±—É–ª—è—Ü–∏–∏ –∏ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ –Ω–∞ –æ–¥–∏–Ω –ø—Ä–æ–±–µ–ª', () => {
            const dirty = '[\n\t{"word": "—Ç–µ—Å—Ç"}\n]';
            const expected = '[{"word":"—Ç–µ—Å—Ç"}]';
            expect(cleanApiResponse(dirty)).toBe(expected);
        });
    });

    // –ì—Ä—É–ø–ø–∞ —Ç–µ—Å—Ç–æ–≤, –ø—Ä–æ–≤–µ—Ä—è—é—â–∞—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã—Ö –æ—à–∏–±–æ–∫
    describe('–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã—Ö –æ—à–∏–±–æ–∫ JSON', () => {

        test('–¥–æ–ª–∂–µ–Ω –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∏–ø–æ–≥—Ä–∞—Ñ—Å–∫–∏–µ –∫–∞–≤—ã—á–∫–∏ –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ', () => {
            const dirty = '[{‚Äúword‚Äù: ¬´—Ç–µ—Å—Ç¬ª}]';
            const expected = '[{"word":"—Ç–µ—Å—Ç"}]';
            expect(cleanApiResponse(dirty)).toBe(expected);
        });

        test('–¥–æ–ª–∂–µ–Ω –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å –≤–∏—Å—è—á—É—é –∑–∞–ø—è—Ç—É—é –≤ –∫–æ–Ω—Ü–µ –º–∞—Å—Å–∏–≤–∞', () => {
            const dirty = '[{"word":"a"},{"word":"b"},]';
            const expected = '[{"word":"a"},{"word":"b"}]';
            expect(cleanApiResponse(dirty)).toBe(expected);
        });

        test('–¥–æ–ª–∂–µ–Ω –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å –≤–∏—Å—è—á—É—é –∑–∞–ø—è—Ç—É—é –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã–≤–∞—é—â–µ–π —Ñ–∏–≥—É—Ä–Ω–æ–π —Å–∫–æ–±–∫–æ–π', () => {
            const dirty = '[{"word":"a","clue":"b",}]';
            const expected = '[{"word":"a","clue":"b"}]';
            expect(cleanApiResponse(dirty)).toBe(expected);
        });
        
        test('–¥–æ–ª–∂–µ–Ω —É–±–∏—Ä–∞—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø—è—Ç—ã–µ –º–µ–∂–¥—É —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏', () => {
            const dirty = '[{"word":"a"},,,{"word":"b"}]';
            const expected = '[{"word":"a"},{"word":"b"}]';
            expect(cleanApiResponse(dirty)).toBe(expected);
        });

        test('–¥–æ–ª–∂–µ–Ω –≤—Å—Ç–∞–≤–ª—è—Ç—å –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –∑–∞–ø—è—Ç—ã–µ –º–µ–∂–¥—É "—Å–ª–∏–ø—à–∏–º–∏—Å—è" –æ–±—ä–µ–∫—Ç–∞–º–∏', () => {
            const dirty = '[{"word":"a"}{"word":"b"}]';
            const expected = '[{"word":"a"},{"word":"b"}]';
            expect(cleanApiResponse(dirty)).toBe(expected);
        });

        test('–¥–æ–ª–∂–µ–Ω –≤—Å—Ç–∞–≤–ª—è—Ç—å –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –∑–∞–ø—è—Ç—ã–µ –º–µ–∂–¥—É –∑–Ω–∞—á–µ–Ω–∏–µ–º –∏ —Å–ª–µ–¥—É—é—â–∏–º –∫–ª—é—á–æ–º', () => {
            const dirty = '[{"word":"—Å–æ–Ω" "clue":"–æ—Ç–¥—ã—Ö"}]';
            const expected = '[{"word":"—Å–æ–Ω","clue":"–æ—Ç–¥—ã—Ö"}]';
            expect(cleanApiResponse(dirty)).toBe(expected);
        });

        test('–¥–æ–ª–∂–µ–Ω –¥–æ–±–∞–≤–ª—è—Ç—å –∑–∞–∫—Ä—ã–≤–∞—é—â—É—é –∫–≤–∞–¥—Ä–∞—Ç–Ω—É—é —Å–∫–æ–±–∫—É, –µ—Å–ª–∏ –æ–Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç', () => {
            const dirty = '[{"word":"—Ç–µ—Å—Ç"}';
            const expected = '[{"word":"—Ç–µ—Å—Ç"}]';
            expect(cleanApiResponse(dirty)).toBe(expected);
        });

        test('–¥–æ–ª–∂–µ–Ω "—Å–ø–∞—Å–∞—Ç—å" –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–π JSON, –Ω–∞—Ö–æ–¥—è –ø–æ—Å–ª–µ–¥–Ω—é—é —Ñ–∏–≥—É—Ä–Ω—É—é —Å–∫–æ–±–∫—É', () => {
            const dirty = '[{"word":"a"},{"word":"b"'; // AI –æ–±–æ—Ä–≤–∞–ª –æ—Ç–≤–µ—Ç
            const expected = '[{"word":"a"}]'; // –û–∂–∏–¥–∞–µ–º, —á—Ç–æ –æ–Ω —Å–ø–∞—Å–µ—Ç –≤—Å–µ, —á—Ç–æ –±—ã–ª–æ –¥–æ –æ–±—Ä—ã–≤–∞
            expect(cleanApiResponse(dirty)).toBe(expected);
        });
    });

    // –ì—Ä—É–ø–ø–∞ —Ç–µ—Å—Ç–æ–≤ –¥–ª—è —Å–∞–º—ã—Ö —Å–ª–æ–∂–Ω—ã—Ö, –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤
    describe('–°–ª–æ–∂–Ω—ã–µ –∏ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ª—É—á–∞–∏', () => {

        test('–Ω–µ –¥–æ–ª–∂–µ–Ω —Ç—Ä–æ–≥–∞—Ç—å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏ –≤–Ω—É—Ç—Ä–∏ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (JSON –≤ JSON)', () => {
            const dirty = '[{"word":"–∫–æ–º–∞–Ω–¥–∞","clue":"–û–ø–∏—Å–∞–Ω–∏–µ: {\\"–¥–µ–π—Å—Ç–≤–∏–µ\\":\\"–±–µ–∂–∞—Ç—å\\"}"}]';
            const expected = '[{"word":"–∫–æ–º–∞–Ω–¥–∞","clue":"–û–ø–∏—Å–∞–Ω–∏–µ: {\\"–¥–µ–π—Å—Ç–≤–∏–µ\\":\\"–±–µ–∂–∞—Ç—å\\"}"}]';
            expect(cleanApiResponse(dirty)).toBe(expected);
        });

        test('–¥–æ–ª–∂–µ–Ω —Å–ø—Ä–∞–≤–ª—è—Ç—å—Å—è —Å –ø–æ–ª–Ω—ã–º —Ö–∞–æ—Å–æ–º –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –æ—à–∏–±–æ–∫ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ', () => {
            const dirty = `–í–æ—Ç –æ—Ç–≤–µ—Ç: \`\`\`json '[{‚Äúword‚Äù: "—Ö–∞–æ—Å" "clue": "–±–µ—Å–ø–æ—Ä—è–¥–æ–∫"},,, {"word":"—Ç–µ—Å—Ç"}{"word":"—Ñ–∏–Ω–∞–ª",}] \`\`\` `;
            const expected = '[{"word":"—Ö–∞–æ—Å","clue":"–±–µ—Å–ø–æ—Ä—è–¥–æ–∫"},{"word":"—Ç–µ—Å—Ç"},{"word":"—Ñ–∏–Ω–∞–ª"}]';
            expect(cleanApiResponse(dirty)).toBe(expected);
        });
    });

    describe('–ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª—é—á–µ–π', () => {
        test('–¥–æ–ª–∂–µ–Ω –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å –¥–≤–æ–µ—Ç–æ—á–∏–µ –≤–Ω—É—Ç—Ä–∏ –∫–∞–≤—ã—á–µ–∫ –∫–ª—é—á–∞', () => {
            const dirty = '[{"word":"a", "clue:" "b"}]'; // "clue:" –≤–º–µ—Å—Ç–æ "clue":
            const expected = '[{"word":"a","clue":"b"}]';
            expect(cleanApiResponse(dirty)).toBe(expected);
        });

        test('–¥–æ–ª–∂–µ–Ω –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–æ–±–µ–ª—ã –≤–Ω—É—Ç—Ä–∏ –∫–ª—é—á–µ–π', () => {
            const dirty = '[{" word ":"a", " clue ":"b"}]';
            const expected = '[{"word":"a","clue":"b"}]';
            expect(cleanApiResponse(dirty)).toBe(expected);
        });

        test('–¥–æ–ª–∂–µ–Ω –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å –∫–∏—Ä–∏–ª–ª–∏—Ü—É –≤ –∫–ª—é—á–∞—Ö (clu–µ -> clue)', () => {
            const dirty = '[{"word":"a", "clu–µ":"b"}]'; // –ó–¥–µ—Å—å —Ä—É—Å—Å–∫–∞—è '–µ'
            const expected = '[{"word":"a","clue":"b"}]';
            expect(cleanApiResponse(dirty)).toBe(expected);
        });
    });
    describe('–ë–∞–∑–æ–≤—ã–µ –∏ –∫—Ä–∞–µ–≤—ã–µ —Å–ª—É—á–∞–∏', () => {
        test('–¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –¥–ª—è null/undefined', () => {
            expect(cleanApiResponse(null)).toBe('[]');
            expect(cleanApiResponse(undefined)).toBe('[]');
        });
        test('–¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –¥–ª—è –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–∏', () => {
            expect(cleanApiResponse('')).toBe('[]');
        });
        test('–¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤, –µ—Å–ª–∏ –Ω–µ—Ç JSON', () => {
            expect(cleanApiResponse('–ü—Ä–æ—Å—Ç–æ —Ç–µ–∫—Å—Ç')).toBe('[]');
        });
    });

    describe('–û—á–∏—Å—Ç–∫–∞ –º—É—Å–æ—Ä–∞', () => {
        test('–¥–æ–ª–∂–µ–Ω —É–¥–∞–ª—è—Ç—å Markdown', () => {
            const dirty = '```json\n[{"word":"a"}]\n```';
            const parsed = JSON.parse(cleanApiResponse(dirty));
            expect(parsed).toHaveLength(1);
            expect(parsed[0].word).toBe('a');
        });
    });

    describe('–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (jsonrepair + —Ä–µ–≥—É–ª—è—Ä–∫–∏)', () => {
        test('–¥–æ–ª–∂–µ–Ω –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø—è—Ç—ã–µ', () => {
            const dirty = '[{"word":"a"}{"word":"b"}]';
            const parsed = JSON.parse(cleanApiResponse(dirty));
            expect(parsed).toHaveLength(2);
        });

        test('–¥–æ–ª–∂–µ–Ω –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å –≤–∏—Å—è—á–∏–µ –∑–∞–ø—è—Ç—ã–µ', () => {
            const dirty = '[{"word":"a"},]';
            const parsed = JSON.parse(cleanApiResponse(dirty));
            expect(parsed).toHaveLength(1);
        });
        
        test('–¥–æ–ª–∂–µ–Ω –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø—è—Ç—ã–µ', () => {
            const dirty = '[{"word":"a"},,,{"word":"b"}]';
            const parsed = JSON.parse(cleanApiResponse(dirty));
            expect(parsed).toHaveLength(2);
        });
    });

    // --- –°–ê–ú–û–ï –í–ê–ñ–ù–û–ï: –¢–ï–°–¢–´ –ù–ê –û–°–ù–û–í–ï –¢–í–û–ò–• –õ–û–ì–û–í ---
    describe('üî• –†–µ–∞–ª—å–Ω—ã–µ –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–∏ –∏–∑ –ª–æ–≥–æ–≤ (Hardcore Mode)', () => {

        test('–õ–æ–≥ 1: –ó–∞–ø—è—Ç–∞—è –≤–º–µ—Å—Ç–æ —Å–ª–æ–≤–∞ –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–∞–≤—ã—á–µ–∫ —É –∫–ª—é—á–∞', () => {
            // –ë—ã–ª–æ: {"word":",",clue:"–°–ø–µ–∫—Ç–∞–∫–ª—å..."}
            const dirty = `[{"word":",",clue:"–°–ø–µ–∫—Ç–∞–∫–ª—å –¥–ª—è –¥–µ—Ç–µ–π"}]`;
            const result = cleanApiResponse(dirty);
            const parsed = JSON.parse(result);
            
            expect(parsed[0]).toHaveProperty('word', ','); // –î–∞, —Å–ª–æ–≤–æ-–∑–∞–ø—è—Ç–∞—è –≤–∞–ª–∏–¥–Ω–æ –¥–ª—è JSON
            expect(parsed[0]).toHaveProperty('clue');
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–ª—é—á clue –ø–æ—á–∏–Ω–∏–ª—Å—è (—Å—Ç–∞–ª–∏ –¥–≤–æ–π–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏)
            expect(result).toContain('"clue":'); 
        });

        test('–õ–æ–≥ 2: –û–¥–∏–Ω–∞—Ä–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏ –≤–Ω—É—Ç—Ä–∏ –¥–≤–æ–π–Ω—ã—Ö (–≥–∏–±—Ä–∏–¥)', () => {
            // –ë—ã–ª–æ: "clue":"'–£—Å—Ç–∞—Ä–µ–≤—à–µ–µ..."
            const dirty = `[{"word":"—Å—Ç–∞—Ä—ã–π–≥–æ–¥","clue":"'–£—Å—Ç–∞—Ä–µ–≤—à–µ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ'"}]`;
            const parsed = JSON.parse(cleanApiResponse(dirty));
            
            // –ú—ã –æ–∂–∏–¥–∞–µ–º, —á—Ç–æ –ø–∞—Ä—Å–µ—Ä –ª–∏–±–æ –æ—Å—Ç–∞–≤–∏—Ç –∏—Ö –∫–∞–∫ —á–∞—Å—Ç—å —Ç–µ–∫—Å—Ç–∞, –ª–∏–±–æ —É–±–µ—Ä–µ—Ç.
            // –ì–ª–∞–≤–Ω–æ–µ - –≤–∞–ª–∏–¥–Ω—ã–π JSON.
            expect(parsed[0].word).toBe('—Å—Ç–∞—Ä—ã–π–≥–æ–¥');
            expect(typeof parsed[0].clue).toBe('string');
        });

        test('–õ–æ–≥ 3: –û–¥–∏–Ω–∞—Ä–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏ –∫–∞–∫ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ JSON', () => {
            // –ë—ã–ª–æ: {"word":"'–æ—Ç–¥—ã—Ö','clue':'–í—Ä–µ–º—è..."}
            const dirty = `[{"word":"'–æ—Ç–¥—ã—Ö'","clue":"'–í—Ä–µ–º—è'"}]`; 
            // –ò–ª–∏ –≤–∞—Ä–∏–∞–Ω—Ç, –≥–¥–µ –Ω–µ–π—Ä–æ—Å–µ—Ç—å –≤–æ–æ–±—â–µ –∑–∞–±—ã–ª–∞ –¥–≤–æ–π–Ω—ã–µ:
            const dirty2 = `[{'word':'–æ—Ç–¥—ã—Ö','clue':'–í—Ä–µ–º—è'}]`;
            
            const parsed = JSON.parse(cleanApiResponse(dirty2));
            expect(parsed[0].word).toBe('–æ—Ç–¥—ã—Ö');
        });

        test('–õ–æ–≥ 4: –ü—Ä–æ–±–µ–ª—ã –≤ –∫–ª—é—á–∞—Ö –∏ –æ–¥–∏–Ω–∞—Ä–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏', () => {
            // –ë—ã–ª–æ: "word":"–≤–æ–ª—à–µ–±—Å—Ç–≤–æ ",' clue ':'–ß—Ç–æ..."
            const dirty = `[{"word":"–≤–æ–ª—à–µ–±—Å—Ç–≤–æ ",' clue ':'–ß—Ç–æ –¥–µ–ª–∞–µ—Ç?'}]`;
            const parsed = JSON.parse(cleanApiResponse(dirty));
            
            expect(parsed[0]).toHaveProperty('clue'); // –ö–ª—é—á –¥–æ–ª–∂–µ–Ω —Å—Ç–∞—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω—ã–º "clue"
            expect(parsed[0].clue).toBe('–ß—Ç–æ –¥–µ–ª–∞–µ—Ç?');
        });

        test('–õ–æ–≥ 5: –ó–∞–ø—è—Ç–∞—è –ø–æ—Å–ª–µ –¥–≤–æ–µ—Ç–æ—á–∏—è', () => {
            // –ë—ã–ª–æ: "clue":,"–ù–µ—á—Ç–æ —á—É–¥–µ—Å–Ω–æ–µ"
            const dirty = `[{"word":"–≤–æ–ª—à–µ–±—Å—Ç–≤–æ","clue":,"–ù–µ—á—Ç–æ —á—É–¥–µ—Å–Ω–æ–µ"}]`;
            const parsed = JSON.parse(cleanApiResponse(dirty));
            
            expect(parsed[0].clue).toBe('–ù–µ—á—Ç–æ —á—É–¥–µ—Å–Ω–æ–µ');
        });
        
        test('–õ–æ–≥ 6: –ö–∏—Ä–∏–ª–ª–∏—Ü–∞ –≤ –∫–ª—é—á–∞—Ö (clu–µ)', () => {
            // clu–µ —Å —Ä—É—Å—Å–∫–æ–π '–µ'
            const dirty = `[{"word":"—Ç–µ—Å—Ç", "clu–µ":"–æ–ø–∏—Å–∞–Ω–∏–µ"}]`; 
            const parsed = JSON.parse(cleanApiResponse(dirty));
            
            expect(parsed[0]).toHaveProperty('clue'); // –î–æ–ª–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å—Å—è –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫—É—é
            expect(parsed[0]).not.toHaveProperty('clu–µ');
        });
    });
});